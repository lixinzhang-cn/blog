# 01.flask+layui 实现注册功能
::: tip 视频教程
[视频教程地址](https://www.bilibili.com/video/BV1ZN411k7nv/?spm_id_from=333.999.0.0&vd_source=fb106110387e029400905bf099f9ac8c)
:::


已经看了 layui 表单相关的知识，接下来就可以实现注册功能，功能逻辑如下：
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="761px" viewBox="-0.5 -0.5 761 582" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2023-06-13T08:25:26.766Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/19.0.3 Chrome/102.0.5005.63 Electron/19.0.3 Safari/537.36&quot; etag=&quot;akPd1RvVaN1Hh0KEJ4wC&quot; version=&quot;19.0.3&quot; type=&quot;device&quot;&gt;&lt;diagram name=&quot;第 1 页&quot; id=&quot;5LWXXuScM8yWzGP_uaGQ&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://viewer.diagrams.net/?client=1&amp;page=0&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:582px;"><defs/><g><ellipse cx="15" cy="27.5" rx="7.5" ry="7.5" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><path d="M 15 35 L 15 60 M 15 40 L 0 40 M 15 40 L 30 40 M 15 60 L 0 80 M 15 60 L 30 80" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 87px; margin-left: 15px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">
用户</div></div></div></foreignObject><text x="15" y="99" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
用户</text></switch></g><rect x="180" y="20" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 50px; margin-left: 181px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
浏览器</div></div></div></foreignObject><text x="240" y="54" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
浏览器</text></switch></g><rect x="440" y="20" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 50px; margin-left: 441px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
后端服务器</div></div></div></foreignObject><text x="500" y="54" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
后端服务器</text></switch></g><path d="M 20 580 L 20 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 240 580 L 239.66 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 500 580 L 499.66 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 140 L 473.63 140" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 478.88 140 L 471.88 143.5 L 473.63 140 L 471.88 136.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 140px; margin-left: 121px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
访问注册页面</div></div></div></foreignObject><text x="121" y="144" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
访问注册页面</text></switch></g><path d="M 40 220 L 213.63 220" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 218.88 220 L 211.88 223.5 L 213.63 220 L 211.88 216.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 221px; margin-left: 124px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
输入手机号
，请求注册</div></div></div></foreignObject><text x="124" y="225" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
输入手机号
，请求注册</text></switch></g><path d="M 240 220 Q 270 220 270 245 Q 270 270 246.37 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 241.12 270 L 248.12 266.5 L 246.37 270 L 248.12 273.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="270" y="230" width="150" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 245px; margin-left: 271px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
校验手机号格式是否正常</div></div></div></foreignObject><text x="345" y="249" fill="#ff0000" font-family="Helvetica" font-size="12px" text-anchor="middle">
校验手机号格式是否正常</text></switch></g><path d="M 220 270 L 46.37 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41.12 270 L 48.12 266.5 L 46.37 270 L 48.12 273.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 269px; margin-left: 140px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
格式不正常提示错误</div></div></div></foreignObject><text x="140" y="273" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
格式不正常提示错误</text></switch></g><path d="M 270 270 L 473.63 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 478.88 270 L 471.88 273.5 L 473.63 270 L 471.88 266.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 271px; margin-left: 371px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
格式正常请求后端</div></div></div></foreignObject><text x="371" y="275" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
格式正常请求后端</text></switch></g><path d="M 480 320 L 276.37 320" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 271.12 320 L 278.12 316.5 L 276.37 320 L 278.12 323.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 322px; margin-left: 381px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回结果
，成功或失败</div></div></div></foreignObject><text x="381" y="326" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回结果
，成功或失败</text></switch></g><path d="M 700 15 C 700 6.72 713.43 0 730 0 C 737.96 0 745.59 1.58 751.21 4.39 C 756.84 7.21 760 11.02 760 15 L 760 65 C 760 73.28 746.57 80 730 80 C 713.43 80 700 73.28 700 65 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 760 15 C 760 23.28 746.57 30 730 30 C 713.43 30 700 23.28 700 15" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 53px; margin-left: 701px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
MySql</div></div></div></foreignObject><text x="730" y="57" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
MySql</text></switch></g><path d="M 730 580 L 729.66 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 500 270 Q 530 270 530 295 Q 530 320 506.37 320" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 501.12 320 L 508.12 316.5 L 506.37 320 L 508.12 323.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="540" y="280" width="170" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 168px; height: 1px; padding-top: 295px; margin-left: 542px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
校验手机号格式<br />
请求第三方服务发送短信</div></div></div></foreignObject><text x="542" y="299" fill="#ff0000" font-family="Helvetica" font-size="12px">
校验手机号格式&#xa;请求第三方服务发送短信</text></switch></g><rect x="280" y="340" width="170" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 168px; height: 1px; padding-top: 350px; margin-left: 282px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
校验返回结果、返回信息</div></div></div></foreignObject><text x="282" y="354" fill="#ff0000" font-family="Helvetica" font-size="12px">
校验返回结果、返回信息</text></switch></g><path d="M 240 320 Q 270 320 270 345 Q 270 370 246.37 370" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 241.12 370 L 248.12 366.5 L 246.37 370 L 248.12 373.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 210 530 L 36.37 530" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 31.12 530 L 38.12 526.5 L 36.37 530 L 38.12 533.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 529px; margin-left: 120px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回登录页</div></div></div></foreignObject><text x="120" y="533" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回登录页</text></switch></g><path d="M 210 490 L 36.37 490" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 31.12 490 L 38.12 486.5 L 36.37 490 L 38.12 493.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 492px; margin-left: 124px;"><div data-drawio-colors="color: #FF0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
失败返回错误信息，重新注册</div></div></div></foreignObject><text x="124" y="496" fill="#FF0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
失败返回错误信息，重新注册</text></switch></g><path d="M 510 490 L 713.63 490" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 718.88 490 L 711.88 493.5 L 713.63 490 L 711.88 486.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 491px; margin-left: 621px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
成功之后将用户数据记录到数据库</div></div></div></foreignObject><text x="621" y="495" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
成功之后将用户数据记录到数据库</text></switch></g><path d="M 480 180 L 266.37 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 261.12 180 L 268.12 176.5 L 266.37 180 L 268.12 183.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 180px; margin-left: 371px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回注册页面</div></div></div></foreignObject><text x="371" y="184" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回注册页面</text></switch></g><path d="M 220 180 L 46.37 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41.12 180 L 48.12 176.5 L 46.37 180 L 48.12 183.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 180px; margin-left: 129px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回注册页面</div></div></div></foreignObject><text x="129" y="184" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回注册页面</text></switch></g><rect x="280" y="490" width="170" height="50" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 168px; height: 1px; padding-top: 515px; margin-left: 282px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
校验返回结果<br />请求错误返回错误信息<br />
请求成功之后重定向到登录页</div></div></div></foreignObject><text x="282" y="519" fill="#ff0000" font-family="Helvetica" font-size="12px">
校验返回结果请求错误返回错误信息请求成功之后重定向到登录页...</text></switch></g><path d="M 240 480 Q 270 480 270 505 Q 270 530 246.37 530" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 241.12 530 L 248.12 526.5 L 246.37 530 L 248.12 533.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 220 370 L 46.37 370" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41.12 370 L 48.12 366.5 L 46.37 370 L 48.12 373.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 369px; margin-left: 130px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回信息</div></div></div></foreignObject><text x="130" y="373" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回信息</text></switch></g><path d="M 40 410 L 213.63 410" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 218.88 410 L 211.88 413.5 L 213.63 410 L 211.88 406.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 411px; margin-left: 124px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
输入短信验证码，请求注册</div></div></div></foreignObject><text x="124" y="415" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
输入短信验证码，请求注册</text></switch></g><path d="M 270 410 L 473.63 410" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 478.88 410 L 471.88 413.5 L 473.63 410 L 471.88 406.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 411px; margin-left: 368px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
校验信息通过之后请求注册</div></div></div></foreignObject><text x="368" y="415" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
校验信息通过之后请求注册</text></switch></g><path d="M 500 410 Q 530 410 530 435 Q 530 460 506.37 460" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 501.12 460 L 508.12 456.5 L 506.37 460 L 508.12 463.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="540" y="420" width="70" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 68px; height: 1px; padding-top: 435px; margin-left: 542px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
校验信息</div></div></div></foreignObject><text x="542" y="439" fill="#ff0000" font-family="Helvetica" font-size="12px">
校验信息</text></switch></g><path d="M 510 330 L 713.63 330" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 718.88 330 L 711.88 333.5 L 713.63 330 L 711.88 326.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 331px; margin-left: 611px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
将手机号、验证码记录到数据库</div></div></div></foreignObject><text x="611" y="335" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
将手机号、验证码记录到数据库</text></switch></g><path d="M 480 480 L 276.37 480" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 271.12 480 L 278.12 476.5 L 276.37 480 L 278.12 483.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 482px; margin-left: 381px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回结果
，成功或失败</div></div></div></foreignObject><text x="381" y="486" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回结果
，成功或失败</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">
Text is not SVG - cannot display</text></a></switch></svg>

## 项目创建

1. 新建 flask 项目
2. 下载 layui 文件，解压之后复制到指定文件
3. 编写前端首页、注册页、登录页。注册页使用之前看过的注册页表单
4. 编写后端路由，实现前后端基本的跳转

### 新建 flask 项目

新建项目的方式有很多种，只要有任意一种方式创建即刻。在这里我直接选择使用 pycharm 进行创建。

新建成功后目录如下

```txt
D:\flask-register>tree /f
D:.
│  app.py
├─static
└─templates
```

### 下载 layui 文件

访问 https://layui.dev/ ，点击直接下载之后就能得到 layui 的静态文件，将其复制到 `static` 目录下，完成之后的目录结构如下

```txt
D:\flask-register>tree /f
卷 软件 的文件夹 PATH 列表
卷序列号为 65F3-3762
D:.
│  app.py
│
├─static
│  │  layui.js
│  │
│  ├─css
│  │      layui.css
│  │
│  └─font
│          iconfont.eot
│          iconfont.svg
│          iconfont.ttf
│          iconfont.woff
│          iconfont.woff2
│
└─templates
```

### 编写静态页面

+ 复制 https://layui.dev/docs/2.8/layout/ 的内容进行修改。完成 `index.html` （首页）的制作。
+ 复制 https://layui.dev/docs/2.8/form/#reg 修改为注册页
+ 复制 https://layui.dev/docs/2.8/form/#login 修改为登录页

::: code-group

```html [index.html]
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="/static/css/layui.css">
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo layui-hide-xs layui-bg-black">正心全栈编程</div>
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item"><a href="">最新活动</a></li>
            <li class="layui-nav-item layui-this"><a href="">核心编程</a></li>
            <li class="layui-nav-item"><a href="">爬虫开发</a></li>
            <li class="layui-nav-item"><a href="">数据分析</a></li>

            <li class="layui-nav-item">
                <a href="JavaScript:;">网站开发</a>
                <dl class="layui-nav-child">
                    <dd><a href="">前端基础</a></dd>
                    <dd><a href="">flask 框架</a></dd>
                    <dd><a href="">flask 项目</a></dd>
                </dl>
            </li>
        </ul>

        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide layui-show-sm-inline-block">
                <a href="javascript:;">
                    <img src="//unpkg.com/outeres@0.0.10/img/layui/icon-v2.png" class="layui-nav-img">
                    登录 / 正心
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;">个人中心</a></dd>
                    <dd><a href="javascript:;">设置</a></dd>
                    <dd><a href="javascript:;">退出</a></dd>
                </dl>
            </li>
        </ul>
    </div>
</div>
<script src="/static/layui.js"></script>
</body>
</html>
```

```html [register.html]
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册页</title>
    <link rel="stylesheet" href="/static/css/layui.css">
</head>
<body>
<style>
    .demo-reg-container {
        width: 320px;
        margin: 21px auto 0;
    }

    .demo-reg-other .layui-icon {
        position: relative;
        display: inline-block;
        margin: 0 2px;
        top: 2px;
        font-size: 26px;
    }
</style>
<form class="layui-form" lay-filter="register-form">
    <div class="demo-reg-container">
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-username"></i>
                </div>
                <input type="text" name="nickname" value="" lay-verify="required" placeholder="昵称" autocomplete="off"
                       class="layui-input" lay-affix="clear">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-row">
                <div class="layui-col-xs7">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                            <i class="layui-icon layui-icon-cellphone"></i>
                        </div>
                        <input type="text" name="mobile" value="" lay-verify="required|phone" placeholder="手机号"
                               lay-reqtext="请填写手机号" autocomplete="off" class="layui-input" id="reg-cellphone">
                    </div>
                </div>
                <div class="layui-col-xs5">
                    <div style="margin-left: 11px;">
                        <button type="button" class="layui-btn layui-btn-fluid layui-btn-primary"
                                lay-on="reg-get-vercode">获取验证码
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-vercode"></i>
                </div>
                <input type="text" name="vercode" value="" lay-verify="required" placeholder="验证码"
                       lay-reqtext="请填写验证码" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-password"></i>
                </div>
                <input type="password" name="password" value="" lay-verify="required" placeholder="密码"
                       autocomplete="off" class="layui-input" id="reg-password" lay-affix="eye">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-password"></i>
                </div>
                <input type="password" name="confirmPassword" value="" lay-verify="required|confirmPassword"
                       placeholder="确认密码" autocomplete="off" class="layui-input" lay-affix="eye">
            </div>
        </div>

        <div class="layui-form-item">
            <input type="checkbox" name="agreement" lay-verify="required" lay-skin="primary" title="同意">
            <a href="#terms" target="_blank" style="position: relative; top: 6px; left: -15px;">
                <ins>用户协议</ins>
            </a>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="demo-reg">注册</button>
        </div>
        <div class="layui-form-item demo-reg-other">
            <label>社交账号注册</label>
            <span style="padding: 0 21px 0 6px;">
        <a href="javascript:;"><i class="layui-icon layui-icon-login-qq" style="color: #3492ed;"></i></a>
        <a href="javascript:;"><i class="layui-icon layui-icon-login-wechat" style="color: #4daf29;"></i></a>
        <a href="javascript:;"><i class="layui-icon layui-icon-login-weibo" style="color: #cf1900;"></i></a>
      </span>
            <a href="/login">登录已有帐号</a>
        </div>
    </div>
</form>
<script src="/static/layui.js"></script>
<script>
    layui.use(function () {
        var $ = layui.$;
        var form = layui.form;
        var layer = layui.layer;
    });
</script>
</body>
</html>
```

```html [login.html]
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录页</title>
    <link rel="stylesheet" href="/static/css/layui.css">
</head>
<body>
<style>
    .demo-login-container {
        width: 320px;
        margin: 21px auto 0;
    }

    .demo-login-other .layui-icon {
        position: relative;
        display: inline-block;
        margin: 0 2px;
        top: 2px;
        font-size: 26px;
    }
</style>
<form class="layui-form">
    <div class="demo-login-container">
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-cellphone"></i>
                </div>
                <input type="text" name="mobile" value="" lay-verify="required" placeholder="手机号"
                       lay-reqtext="请填写手机号" autocomplete="off" class="layui-input" lay-affix="clear">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-wrap">
                <div class="layui-input-prefix">
                    <i class="layui-icon layui-icon-password"></i>
                </div>
                <input type="password" name="password" value="" lay-verify="required" placeholder="密   码"
                       lay-reqtext="请填写密码" autocomplete="off" class="layui-input" lay-affix="eye">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-row">
                <div class="layui-col-xs7">
                    <div class="layui-input-wrap">
                        <div class="layui-input-prefix">
                            <i class="layui-icon layui-icon-vercode"></i>
                        </div>
                        <input type="text" name="captcha" value="" lay-verify="required" placeholder="验证码"
                               lay-reqtext="请填写验证码" autocomplete="off" class="layui-input" lay-affix="clear">
                    </div>
                </div>
                <div class="layui-col-xs5">
                    <div style="margin-left: 10px;">
                        <img src="https://www.oschina.net/action/user/captcha"
                             id="captchaImage">
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <input type="checkbox" name="remember" lay-skin="primary" title="记住密码">
            <a href="#forget" style="float: right; margin-top: 7px;">忘记密码？</a>
        </div>
        <div class="layui-form-item">
            <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="demo-login">登录</button>
        </div>
        <div class="layui-form-item demo-login-other">
            <label>社交账号登录</label>
            <span style="padding: 0 21px 0 6px;">
                <a href="javascript:;"><i class="layui-icon layui-icon-login-qq" style="color: #3492ed;"></i></a>
                <a href="javascript:;"><i class="layui-icon layui-icon-login-wechat" style="color: #4daf29;"></i></a>
                <a href="javascript:;"><i class="layui-icon layui-icon-login-weibo" style="color: #cf1900;"></i></a>
              </span>
            或 <a href="/register">注册帐号</a>
        </div>
    </div>
</form>
<script src="/static/layui.js"></script>
<script>
    layui.use(function () {
        var form = layui.form;
        var layer = layui.layer;
        // 提交事件
        form.on('submit(demo-login)', function (data) {
            var field = data.field; // 获取表单字段值
            // 显示填写结果，仅作演示用
            layer.alert(JSON.stringify(field), {
                title: '当前填写的字段值'
            });
            // 此处可执行 Ajax 等操作
            // …
            return false; // 阻止默认 form 跳转
        });
    });
</script>
</body>
</html>
```

:::

### 后端适配

前端编写好了之后，需要适配后端路由才能实现访问。

::: code-group

```python [app.py]
from flask import Flask, render_template

app = Flask(__name__)


@app.route('/')
def index_view():
    return render_template('index.html')


@app.route('/register')
def register_view():
    return render_template('register.html')


@app.route('/login')
def login_view():
    return render_template('login.html')


if __name__ == '__main__':
    app.run(debug=True)
```

:::

后端路由编写好了之后，如果想要实现联调，就需要修改前端页面的逻辑。

1. 没有登录之前不显示个人信息，只显示左上角的登录按钮，点击登录按钮调整到登录页面。
2. 登录是没有账号，就先进行注册。注册页面如果有账号就跳转到登录页面。
3. 注册账号成功之后跳转到登录页面

## 实现注册逻辑

注册逻辑观看最开始的时序图。

在实现逻辑之前，先完善一下前端跳转页面

1、没有登录之前不显示个人信息，只显示左上角的登录按钮，修改 `index.html` 的内容。

```html

<ul class="layui-nav layui-layout-right">
    <li class="layui-nav-item layui-hide layui-show-sm-inline-block">
        {% if not is_login %}
        <a href="/login">
            登录
        </a>
        {% else %}
        <a href="javascript:;">
            <img src="//unpkg.com/outeres@0.0.10/img/layui/icon-v2.png" class="layui-nav-img">
            登录 / 正心
        </a>
        <dl class="layui-nav-child">
            <dd><a href="javascript:;">个人中心</a></dd>
            <dd><a href="javascript:;">设置</a></dd>
            <dd><a href="javascript:;">退出</a></dd>
        </dl>
        {% endif %}
    </li>
</ul>
```

2、登录是没有账号，就先进行注册。注册页面如果有账号就跳转到登录页面。

修改 `login.html`

```html
<a href="/register">注册帐号</a>
```

修改 `register.html`

```html
<a href="/login">登录已有帐号</a>
```

### 前端校验手机号

用户输入昵称、手机号码，点击获取验证码之前前端需要校验格式是否符合。

发送短信接口请看附录

1、输入手机号之后进行校验

```html

<script>
    layui.use(function () {
        var $ = layui.$;
        var form = layui.form;
        var layer = layui.layer;
        var util = layui.util;

        // 普通事件
        util.on('lay-on', {
            // 获取验证码
            'reg-get-vercode': function (othis) {
                var isvalid = form.validate('#reg-cellphone'); // 主动触发验证，v2.7.0 新增
                // 验证通过
                if (isvalid) {
                    // {#layer.msg('手机号规则验证通过');#}
                    // 此处可继续书写「发送验证码」等后续逻辑
                    let data = form.val('register-form');
                    // 发送请求
                    fetch('/api/send_register_sms', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({'mobile': data.mobile})
                    }).then(response => response.json()).then(data => {
                        // 处理后端的响应数据
                        if (!data.code) {
                            layer.msg(data.message, {icon: 1})
                        } else {
                            layer.msg(data.message, {icon: 2})
                        }
                    })
                }
            }
        });
    });
</script>
```

点击获取验证码之后，就会发送请求到后端，然后后端处理完之后返回结果给前端。

### 后端发送短信验证码

后端获取数据之后

1. 解析前端传递过来的手机号，然后进行校验
2. 调用第三方工具下发注册短信验证码（腾讯云、阿里云就有对于的服务）
3. 将手机号、短信验证码记录到数据库。下次提交时再进行校验

```python
import logging
import re
import random
from flask import Flask, render_template, request, session

app = Flask(__name__)
app.secret_key = 'notes.zhengxinonly.com'


@app.post('/api/send_register_sms')
def send_register_sms():
    # 1. 解析前端传递过来的数据
    data = request.get_json()
    mobile = data['mobile']

    # 2. 校验手机号码
    pattern = r'^1[3-9]\d{9}$'
    ret = re.match(pattern, mobile)
    if not ret:
        return {
            'message': '电话号码不符合格式',
            'code': -1
        }

    # 3. 发送短信验证码，并记录
    session['mobile'] = mobile
    # 3.1 生成随机验证码
    code = random.choices('123456789', k=6)
    session['code'] = ''.join(code)
    logging.warning(code)
    return {
        'message': '发送短信成功',
        'code': 0
    }

```

因为是一个简单的案例，就没有调用腾讯云短信进行测试了，而是直接把正确结果返回。对于短信与验证码也没有存储到数据库了，而是放在
session 里面进行返回，下次请求注册时，再从里面进行提取。

### 实现注册逻辑

#### 前端部分

在手机收到短信验证码之后，前端填入验证码，然后再输入两次密码，点击同意协议按钮，就能实现注册。在这同时需要做验证验证码与密码。

```html

<script>
    layui.use(function () {
        var $ = layui.$;
        var form = layui.form;
        var layer = layui.layer;
        var util = layui.util;

        // 自定义验证规则
        form.verify({
            // 确认密码
            confirmPassword: function (value, item) {
                var passwordValue = $('#reg-password').val();
                if (value !== passwordValue) {
                    return '两次密码输入不一致';
                }
            }
        });

        // 提交事件
        form.on('submit(demo-reg)', function (data) {
            var field = data.field; // 获取表单字段值

            // 是否勾选同意
            if (!field.agreement) {
                layer.msg('您必须勾选同意用户协议才能注册');
                return false;
            }

            // 此处可执行 Ajax 等操作
            fetch('/api/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(field)
            }).then(response => response.json()).then(data => {
                // 处理后端的响应数据
                if (!data.code) {
                    layer.msg(data.message, {icon: 1})
                    setTimeout(function () {
                        location.href = '/login'
                    }, 2000)
                } else {
                    layer.msg(data.message, {icon: 2})
                }
            })

            return false; // 阻止默认 form 跳转
        });
    });
</script>
```

#### 后端逻辑

**数据库**

小案例，使用 sqlite 是最方便的。

:::code-group

```python [db.py]
import sqlite3


class Database:
    def __init__(self):
        self.conn = sqlite3.connect('flask-layui.sqlite')
        self.cursor = self.conn.cursor()

    def create_table(self):
        sql = """create table user
            (
                id       integer primary key,
                nickname varchar(255),
                mobile   varchar(50),
                password varchar(50)
            );
            """
        self.cursor.execute(sql)
        self.conn.commit()

    def insert(self, nickname, mobile, password):
        sql = 'insert into user(nickname, mobile, password) values (?, ?, ?);'
        self.cursor.execute(sql, (nickname, mobile, password))
        self.conn.commit()

    def search(self, mobile):
        sql = 'select password from user where mobile=?;'
        self.cursor.execute(sql, (mobile,))
        return self.cursor.fetchone()


db = Database()

if __name__ == '__main__':
    db.create_table()
    # db.insert('正心全栈编程', '18675867241', '123456')
    # ret = db.search('18675867241')
    # print(ret)
```

```python [app.py]
from db import Database


@app.post('/api/register')
def register_api():
    # 1. 解析前端传递过来的数据
    data = request.get_json()
    vercode = data['vercode']
    vercode2 = session['code']
    if vercode != vercode2:
        return {
            'message': '短信验证码错误',
            'code': -1
        }

    nickname = data['nickname']
    mobile = data['mobile']
    password = data['password']
    if not all([nickname, mobile, password]):
        return {
            'message': '数据缺失',
            'code': -1
        }
    Database().insert(nickname, mobile, password)
    return {
        'message': '注册用户成功',
        'code': 0
    }
```

:::

## 实现登录逻辑

登录时序图

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="762px" viewBox="-0.5 -0.5 762 532" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2023-06-13T12:51:41.437Z&quot; agent=&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/19.0.3 Chrome/102.0.5005.63 Electron/19.0.3 Safari/537.36&quot; etag=&quot;Vs5m1Xaacm2qYYiIOHDc&quot; version=&quot;19.0.3&quot; type=&quot;device&quot;&gt;&lt;diagram name=&quot;第 1 页&quot; id=&quot;5LWXXuScM8yWzGP_uaGQ&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://viewer.diagrams.net/?client=1&amp;page=0&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:532px;"><defs/><g><ellipse cx="15" cy="27.5" rx="7.5" ry="7.5" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><path d="M 15 35 L 15 60 M 15 40 L 0 40 M 15 40 L 30 40 M 15 60 L 0 80 M 15 60 L 30 80" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 87px; margin-left: 15px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">
用户</div></div></div></foreignObject><text x="15" y="99" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
用户</text></switch></g><rect x="180" y="20" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 50px; margin-left: 181px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
浏览器</div></div></div></foreignObject><text x="240" y="54" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
浏览器</text></switch></g><rect x="440" y="20" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 50px; margin-left: 441px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
后端服务器</div></div></div></foreignObject><text x="500" y="54" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
后端服务器</text></switch></g><path d="M 20 530 L 20 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 239.66 530 L 239.66 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 499.66 530 L 499.66 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 140 L 473.63 140" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 478.88 140 L 471.88 143.5 L 473.63 140 L 471.88 136.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 141px; margin-left: 131px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
访问登录页面</div></div></div></foreignObject><text x="131" y="145" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
访问登录页面</text></switch></g><path d="M 480 180 L 276.37 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 271.12 180 L 278.12 176.5 L 276.37 180 L 278.12 183.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 179px; margin-left: 360px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回登录页面</div></div></div></foreignObject><text x="360" y="183" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回登录页面</text></switch></g><path d="M 230 260 L 56.37 260" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 51.12 260 L 58.12 256.5 L 56.37 260 L 58.12 263.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 259px; margin-left: 134px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回登录页面</div></div></div></foreignObject><text x="134" y="263" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回登录页面</text></switch></g><path d="M 270 220 L 473.63 220" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 478.88 220 L 471.88 223.5 L 473.63 220 L 471.88 216.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 221px; margin-left: 368px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
请求图片验证码</div></div></div></foreignObject><text x="368" y="225" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
请求图片验证码</text></switch></g><path d="M 480 260 L 276.37 260" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 271.12 260 L 278.12 256.5 L 276.37 260 L 278.12 263.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 259px; margin-left: 370px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回图片验证码</div></div></div></foreignObject><text x="370" y="263" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回图片验证码</text></switch></g><path d="M 40 320 L 213.63 320" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 218.88 320 L 211.88 323.5 L 213.63 320 L 211.88 316.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 321px; margin-left: 124px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
输入信息进行登录</div></div></div></foreignObject><text x="124" y="325" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
输入信息进行登录</text></switch></g><path d="M 240 320 Q 270 320 270 345 Q 270 370 246.37 370" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 241.12 370 L 248.12 366.5 L 246.37 370 L 248.12 373.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="270" y="330" width="150" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 345px; margin-left: 271px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
校验信息是否正确</div></div></div></foreignObject><text x="345" y="349" fill="#ff0000" font-family="Helvetica" font-size="12px" text-anchor="middle">
校验信息是否正确</text></switch></g><path d="M 220 370 L 46.37 370" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41.12 370 L 48.12 366.5 L 46.37 370 L 48.12 373.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 369px; margin-left: 140px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
格式不正常提示错误</div></div></div></foreignObject><text x="140" y="373" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
格式不正常提示错误</text></switch></g><path d="M 270 380 L 473.63 380" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 478.88 380 L 471.88 383.5 L 473.63 380 L 471.88 376.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 381px; margin-left: 372px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
格式正常请求登录</div></div></div></foreignObject><text x="372" y="385" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
格式正常请求登录</text></switch></g><path d="M 480 430 L 276.37 430" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 271.12 430 L 278.12 426.5 L 276.37 430 L 278.12 433.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 432px; margin-left: 381px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回结果
，成功或失败</div></div></div></foreignObject><text x="381" y="436" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回结果
，成功或失败</text></switch></g><path d="M 700 15 C 700 6.72 713.43 0 730 0 C 737.96 0 745.59 1.58 751.21 4.39 C 756.84 7.21 760 11.02 760 15 L 760 65 C 760 73.28 746.57 80 730 80 C 713.43 80 700 73.28 700 65 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 760 15 C 760 23.28 746.57 30 730 30 C 713.43 30 700 23.28 700 15" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 53px; margin-left: 701px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
MySql</div></div></div></foreignObject><text x="730" y="57" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">
MySql</text></switch></g><path d="M 729.66 530 L 729.66 100" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 500 380 Q 530 380 530 405 Q 530 430 506.37 430" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 501.12 430 L 508.12 426.5 L 506.37 430 L 508.12 433.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="530" y="390" width="120" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 405px; margin-left: 531px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
校验信息是否正常</div></div></div></foreignObject><text x="590" y="409" fill="#ff0000" font-family="Helvetica" font-size="12px" text-anchor="middle">
校验信息是否正常</text></switch></g><path d="M 510 250 L 713.63 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 718.88 250 L 711.88 253.5 L 713.63 250 L 711.88 246.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 251px; margin-left: 608px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
记录当前验证码</div></div></div></foreignObject><text x="608" y="255" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
记录当前验证码</text></switch></g><rect x="270" y="450" width="170" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 465px; margin-left: 271px;"><div data-drawio-colors="color: #ff0000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">
登录成功之后重定向到首页</div></div></div></foreignObject><text x="355" y="469" fill="#ff0000" font-family="Helvetica" font-size="12px" text-anchor="middle">
登录成功之后重定向到首页</text></switch></g><path d="M 240 440 Q 270 440 270 465 Q 270 490 246.37 490" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 241.12 490 L 248.12 486.5 L 246.37 490 L 248.12 493.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 220 500 L 46.37 500" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41.12 500 L 48.12 496.5 L 46.37 500 L 48.12 503.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 499px; margin-left: 140px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
返回首页</div></div></div></foreignObject><text x="140" y="503" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
返回首页</text></switch></g><path d="M 230 430 L 46.37 430" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 41.12 430 L 48.12 426.5 L 46.37 430 L 48.12 433.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 432px; margin-left: 139px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
失败返回错误信息，重新登录</div></div></div></foreignObject><text x="139" y="436" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">
失败返回错误信息，重新登录</text></switch></g><path d="M 510 380 L 713.63 380" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 718.88 380 L 711.88 383.5 L 713.63 380 L 711.88 376.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 381px; margin-left: 621px;"><div data-drawio-colors="color: #ff0000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">
查询数据库</div></div></div></foreignObject><text x="621" y="385" fill="#ff0000" font-family="Helvetica" font-size="11px" text-anchor="middle">
查询数据库</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">
Text is not SVG - cannot display</text></a></switch></svg>

### 图片验证码

1. 客户端请求服务器获得图片验证码
2. 服务器返回图片，将生成的验证码保存到数据库
3. 客户端携带验证码进行请求，服务器校验数据
4. 登录成功之后跳转到首页，登录失败则重新登录

#### 前端发送请求

生成 uuid 用于记录验证码

```html

<script>
    // 生成 uuid
    function generateUUID() {
        var d = new Date().getTime();
        if (window.performance && typeof window.performance.now === 'function') {
            d += performance.now(); //use high-precision timer if available
        }
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,
                function (c) {
                    var r = (d + Math.random() * 16) % 16 | 0;
                    d = Math.floor(d / 16);
                    return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
                });
        return uuid;
    }

</script>
```

图片验证码更新

```html

<script>
    layui.use(function () {
        var form = layui.form;
        var layer = layui.layer;
        var $ = layui.$;
        var captcha_uuid = '';

        // 点击按钮更新验证码
        $('#captchaImage').click(function () {
            // 浏览器要发起图片验证码请求/captcha_code?captcha_code_uuid=xxxxx
            captcha_uuid = generateUUID();
            document.getElementById('captchaImage').src = '/get_captcha?captcha_uuid=' + captcha_uuid;
        });

        captcha_uuid = generateUUID();
        document.getElementById('captchaImage').src = '/get_captcha?captcha_uuid=' + captcha_uuid;
    });
</script>
```

#### 后端生成图片验证码

安装依赖

```shell
pip install captcha
```

然后编写后端的视图

:::code-group [get_captcha.py]

```python
# filename: /get_captcha.py
from io import BytesIO
from random import choices

from captcha.image import ImageCaptcha
from flask import make_response
from PIL import Image


def gen_captcha(content="0123456789"):
    """生成验证码"""
    image = ImageCaptcha()
    # 获取字符串
    captcha_text = "".join(choices(content, k=4))
    # 生成图像
    captcha_image = Image.open(image.generate(captcha_text))
    return captcha_text, captcha_image


# 生成验证码
def get_captcha_code_and_content():
    code, image = gen_captcha()
    out = BytesIO()
    image.save(out, "png")
    out.seek(0)
    content = out.read()  # 读取图片的二进制数据做成响应体
    return code, content


if __name__ == '__main__':
    code, content = get_captcha_code_and_content()
    print(code, content)

```

```python [app.py]
from get_captcha import get_captcha_code_and_content


@app.get('/get_captcha')
def get_captcha_view():
    # 1. 获取参数
    captcha_uuid = request.args.get("captcha_uuid")
    # 2. 生成验证码
    code, content = get_captcha_code_and_content()

    # 3. 记录数据到数据库（用session代替）
    session['code'] = code
    resp = make_response(content)  # 读取图片的二进制数据做成响应体
    resp.content_type = "image/png"
    # 4. 错误处理

    # 5. 响应返回
    return resp
```

:::

### 前端请求进行登录

```html

<script>
    layui.use(function () {
        var form = layui.form;
        var layer = layui.layer;
        var captcha_uuid = '';

        // 提交事件
        form.on('submit(demo-login)', function (data) {
            var field = data.field; // 获取表单字段值
            // 显示填写结果，仅作演示用
            field['captcha_uuid'] = captcha_uuid

            // 此处可执行 Ajax 等操作
            fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(field)
            }).then(response => response.json()).then(data => {
                if (!data.code) {
                    layer.msg(data.message, {icon: 1})
                    setTimeout(function () {
                        location.href = '/'
                    }, 2000)
                } else {
                    layer.msg(data.message, {icon: 2})
                }
            })
            return false; // 阻止默认 form 跳转
        });
    });
</script>
```

### 后端验证登录

编写登录接口

```python
@app.post('/api/login')
def login_api():
    data = request.get_json()
    ret = Database().search(data['mobile'])
    code = session['code']
    if code != data['captcha']:
        return {
            'message': '验证码错误',
            'code': -1
        }
    if not ret:
        return {
            'message': '用户不存在',
            'code': -1
        }
    pwd = ret[0]
    if pwd != data['password']:
        return {
            'message': '用户密码错误',
            'code': -1
        }
    session['is_login'] = True  # 记录用户登录
    return {
        'message': '用户登录成功',
        'code': 0
    }

```

完善 `index.html` 渲染

```python
@app.route('/')
def index_view():
    is_login = session.get('is_login')  # // [!code ++]
    return render_template('index.html')  # // [!code --]
    return render_template('index.html', is_login=is_login)  # // [!code ++]
```

## 附录：API

https://apifox.com/apidoc/shared-1705c3ba-b68b-4ae4-b635-eacc8f7949a9